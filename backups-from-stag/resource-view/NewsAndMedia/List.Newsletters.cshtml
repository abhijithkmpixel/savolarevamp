@model Telerik.Sitefinity.Frontend.DynamicContent.Mvc.Models.DynamicContentListViewModel
@using System.Globalization
@using System.Threading
@using Telerik.Sitefinity.Frontend.Mvc.Helpers;
@{
    var timeCorrection = 4;
    var groupped = Model.Items.GroupBy(i =>
    {
        var date = (DateTime)i.Fields.GetMemberValue("Date");

        date = date.AddHours(timeCorrection);
        return date.ToString("yyyy", new CultureInfo("en"));
    }).Select(i => new { year = i.Key, items = i }).OrderByDescending(i => i.year);
    string current = null;
}
<div class="@Model.CssClass">

    @foreach (var group in groupped)
        {
            switch (current)
            {
                case "":
                    current = "green";
                    break;
                case "green":
                    current = "grey";
                    break;
                default:
                case "grey":
                    current = "";
                    break;

            }
            

    
        <div class="row padding-s-bottom padding-s-top"><h2 class="from-h1 margin-xl-bottom">@group.year</h2>
            @foreach (var item in group.items.OrderByDescending(i =>
            {

                var date = (DateTime)i.Fields.GetMemberValue("Date");
                date = date.AddHours(timeCorrection);
                return date.ToString("MM", new CultureInfo("en"));
            }))
            {
                var navigateUrl = HyperLinkHelpers.GetDetailPageUrl(item, ViewBag.DetailsPageId, ViewBag.OpenInSamePage, Model.UrlKeyPrefix).ToString();
                var docUrl = item.Fields.Document != null ? item.Fields.Document.Fields.MediaUrl.ToString().Split('?')[0] : "";

                var date = (DateTime)item.Fields.GetMemberValue("Date");
                date = date.AddHours(timeCorrection);
                var month = date.Month;
                var quarter = 1;
                if (month >= 1 && month <= 3){quarter = 1;}
                else if (month >= 4 && month <= 6) {quarter = 2;}
                else if (month >= 7 && month <= 9) { quarter = 3; }
                else { quarter = 4; }
                <div class="col-xs-6 col-md-3"><div class="media-box newsletter-box">
                    <a @Html.Raw(docUrl != "" ? "target='_blank' title='Opens in a new window' rel='noopener'" : "") href="@(docUrl != "" ? docUrl : navigateUrl)" aria-label="@item.Fields.Title">
                    <span class="@current">@(string.Format("Q{0}", quarter))</span></a>
                    <div class="media-box-meta"><h2 class="h3 body-large">
                    <a class="link link-grey" href="@(docUrl != "" ? docUrl : navigateUrl)"  @Html.Raw(docUrl != "" ? "target='_blank' title='Opens in a new window' rel='noopener'" : "")>@item.Fields.Title</a></h2></div></div></div>
            }

        </div>

    }

</div>


